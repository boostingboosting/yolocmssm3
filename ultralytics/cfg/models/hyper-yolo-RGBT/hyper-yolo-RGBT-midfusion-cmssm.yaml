# Ultralytics YOLO üöÄ, AGPL-3.0 license
# Hyper-YOLO object detection model with N3-N5 outputs. 
# hyper-yolo Á≥ªÂàóÁöÑÂéüÂßãÊñá‰ª∂Êù•Ëá™‰∫éÈ≠îÈ¨ºÈù¢ÂÖ∑ÁöÑYOLOv11È°πÁõÆ
# Parameters
nc: 1  # number of classes
scales: # model compound scaling constants, i.e. 'model=hyper-yolon.yaml' will call hyper-yolo.yaml with scale 'n'
  # [depth, width, max_channels, threshold] ,thresholdÁî®‰∫éŒµ
  n: [0.33, 0.25, 1024, 6]
  s: [0.33, 0.50, 1024, 8]
  m: [0.67, 0.75, 768, 10]
  l: [1.00, 1.00, 512, 10]
  x: [1.00, 1.25, 512, 12]

ch: 6
# Hyper-YOLO backbone
backbone:
  - [-1, 1, Silence, []]  # 0-P1/2

  # visible
  - [0, 1, SilenceChannel, [0,3]]  # 1-P1/2
  - [-1, 1, Conv, [64, 3, 2]]  # 2-B1/2
  - [-1, 1, Conv, [128, 3, 2]]  # 3
  - [-1, 3, MANet, [128, True, 2, 3]] # 4-B2/4
  - [-1, 1, Conv, [256, 3, 2]]  # 5
  - [-1, 6, MANet, [256, True, 2, 5]] # 6-B3/8
  - [-1, 1, Conv, [512, 3, 2]]  # 7
  - [-1, 6, MANet, [512, True, 2, 5]] # 8-B4/16
  - [-1, 1, Conv, [1024, 3, 2]]  # 9-P5/32
  - [-1, 3, MANet, [1024, True, 2, 3]] # 10

  # infrared
  - [0, 1, SilenceChannel, [3,6]]  # 11-P1/2
  - [-1, 1, Conv, [64, 3, 2]]  # 12-B1/2
  - [-1, 1, Conv, [128, 3, 2]]  # 13
  - [-1, 3, MANet, [128, True, 2, 3]] # 14-B2/4
  - [-1, 1, Conv, [256, 3, 2]]  # 15
  - [-1, 6, MANet, [256, True, 2, 5]] # 16-B3/8
  - [-1, 1, Conv, [512, 3, 2]]  # 17
  - [-1, 6, MANet, [512, True, 2, 5]] # 18-B4/16
  - [-1, 1, Conv, [1024, 3, 2]]  # 19-P5/32
  - [-1, 3, MANet, [1024, True, 2, 3]] # 20
  

  # - [[6, 16], 1, Concat, [1]]  # cat backbone B3   21
  # - [[8, 18], 1, Concat, [1]]  # cat backbone B4   22
  # - [[10, 20], 1, Concat, [1]]  # cat backbone P5   23

#   - [-1, 1, SPPF, [1024, 5]]  # 24-B5/32

# # Hyper-YOLO head
# head:
#   # Semantic Collecting
#   - [2, 1, nn.AvgPool2d, [8, 8, 0]] # 25
#   - [4, 1, nn.AvgPool2d, [4, 4, 0]] # 26
#   - [6, 1, nn.AvgPool2d, [2, 2, 0]] # 27

#   # infrared
#   - [12, 1, nn.AvgPool2d, [8, 8, 0]] # 28
#   - [14, 1, nn.AvgPool2d, [4, 4, 0]] # 29
#   - [16, 1, nn.AvgPool2d, [2, 2, 0]] # 30

#   - [24, 1, nn.Upsample, [None, 2, 'nearest']] # 31
#   - [[25,26,27,28,29,30,31], 1, Concat, [1]]  # cat 32

#   # Hypergraph Computation
#   - [-1, 1, Conv, [512, 1, 1]] # 33
#   - [-1, 1, HyperComputeModule, [512]] # 34
#   - [-1, 3, MANet, [512, True, 2, 3]] # 35
# #
#   # Semantic Collecting
#   - [-1, 1, nn.AvgPool2d, [2, 2, 0]] # 36
#   - [[-1,24], 1, Concat, [1]]  # cat 37
#   - [-1, 1, Conv, [1024, 1, 1]] # 38 P5
# #
#   - [[35, 22], 1, Concat, [1]]  # cat 39
#   - [-1, 3, MANet, [512, False, 2, 3]]  # 40 P4

#   - [35, 1, nn.Upsample, [None, 2, 'nearest']] # 41
#   - [[-1, 21], 1, Concat, [1]]  # cat 42
#   - [-1, 3, MANet, [256, False, 2, 3]]  # 43 P3/N3
# #
#   - [-1, 1, Conv, [256, 3, 2]] # 44
#   - [[-1, 40], 1, Concat, [1]]  # 45 cat
#   - [-1, 3, MANet, [512, False, 2, 3]]  # 46 N4
# #
#   - [-1, 1, Conv, [512, 3, 2]] # 47
#   - [[-1, 38], 1, Concat, [1]]  # 48 cat
#   - [-1, 3, C2f, [1024, False]]  # 49 N5
#   - [[43, 46, 49], 1, Detect, [nc]]  # Detect(N3, N4, N5)
##  - [[10], 1, Detect, [nc]]  # Detect(N3, N4, N5)





# # # # Ê≤°ÊúâCenterPredictor
#   - [ [2, 12], 1, RGBAdjuster, [16, 9, 4]]  #  21
#   # - [ [2, 12], 1, RGBAdjuster, [16, 9, 4, True, False, False, False]]  #  21  centerpoint
#   # - [ [2, 12], 1, RGBAdjuster, [16, 9, 4, False, True, False, False]]  #  21  uav_exist
#   # - [ [2, 12], 1, RGBAdjuster, [16, 9, 4, False, False, True, False]]  #  21  weight_map
#   # - [ [2, 12], 1, RGBAdjuster, [16, 9, 4, False, False, False, True]]  #  21  local_point
#   - [ -1, 1, SilenceList, [ 16, 0 ] ]  # 22 #rgb
#   - [ 21, 1, SilenceList, [ 16, 1 ] ]  # 23 #rgb‚Äîcenterpoints
#   - [ 21, 1, SilenceList, [ 16, 2 ] ]  # 24 #rgb-uav_exist
#   - [ 21, 1, SilenceList, [ 16, 3 ] ]  # 25 #rgb-ir-offsets

#   - [ [4, 14], 1, RGBAdjuster, [32, 7, 3]]  #  26
#   # - [ [4, 14], 1, RGBAdjuster, [32, 7, 3, True, False, False, False]]  #  21  centerpoint
#   # - [ [4, 14], 1, RGBAdjuster, [32, 7, 3, False, True, False, False]]  #  21  uav_exist
#   # - [ [4, 14], 1, RGBAdjuster, [32, 7, 3, False, False, True, False]]  #  21  weight_map
#   # - [ [4, 14], 1, RGBAdjuster, [32, 7, 3, False, False, False, True]]  #  21  local_point
#   - [ -1, 1, SilenceList, [ 32, 0 ] ]  # 27 #rgb
#   - [ 21, 1, SilenceList, [ 32, 1 ] ]  # 28 #rgb‚Äîcenterpoints
#   - [ 21, 1, SilenceList, [ 32, 2 ] ]  # 29 #rgb-uav_exist
#   - [ 21, 1, SilenceList, [ 32, 3 ] ]  # 30 #rgb-ir-offsets

#   - [ [6, 16], 1, RGBAdjuster, [64, 5, 2]]  #  31
#   # - [ [6, 16], 1, RGBAdjuster, [64, 5, 2, True, False, False, False]]  #  21  centerpoint
#   # - [ [6, 16], 1, RGBAdjuster, [64, 5, 2, False, True, False, False]]  #  21  uav_exist
#   # - [ [6, 16], 1, RGBAdjuster, [64, 5, 2, False, False, True, False]]  #  21  weight_map
#   # - [ [6, 16], 1, RGBAdjuster, [64, 5, 2, False, False, False, True]]  #  21  local_point
#   - [ -1, 1, SilenceList, [ 64, 0 ] ]  # 32 #rgb
#   - [ 21, 1, SilenceList, [ 64, 1 ] ]  # 33 #rgb‚Äîcenterpoints
#   - [ 21, 1, SilenceList, [ 64, 2 ] ]  # 34 #rgb-uav_exist
#   - [ 21, 1, SilenceList, [ 64, 3 ] ]  # 35 #rgb-ir-offsets

#   - [ [8, 18], 1, RGBAdjuster, [128, 3, 1]]  #  36
#   # - [ [8, 18], 1, RGBAdjuster, [128, 3, 1, True, False, False, False]]  #  21  centerpoint
#   # - [ [8, 18], 1, RGBAdjuster, [128, 3, 1, False, True, False, False]]  #  21  uav_exist
#   # - [ [8, 18], 1, RGBAdjuster, [128, 3, 1, False, False, True, False]]  #  21  weight_map
#   # - [ [8, 18], 1, RGBAdjuster, [128, False, False, False, True]]  #  21  local_point
#   - [ -1, 1, SilenceList, [ 128, 0 ] ]  # 37 #rgb
#   - [ 21, 1, SilenceList, [ 128, 1 ] ]  # 38 #rgb‚Äîcenterpoints
#   - [ 21, 1, SilenceList, [ 128, 2 ] ]  # 39 #rgb-uav_exist
#   - [ 21, 1, SilenceList, [ 128, 3 ] ]  # 40 #rgb-ir-offsets

#   - [ [10, 20], 1, RGBAdjuster, [256, 3, 1]]  #  41
#   # - [ [10, 20], 1, RGBAdjuster, [256, 3, 1, True, False, False, False]]  #  21  centerpoint
#   # - [ [10, 20], 1, RGBAdjuster, [256, 3, 1, False, True, False, False]]  #  21  uav_exist
#   # - [ [10, 20], 1, RGBAdjuster, [256, 3, 1, False, False, True, False]]  #  21  weight_map
#   # - [ [10, 20], 1, RGBAdjuster, [256, 3, 1, False, False, False, True]]  #  21  local_point
#   - [ -1, 1, SilenceList, [ 256, 0 ] ]  # 42 #rgb
#   - [ 21, 1, SilenceList, [ 256, 1 ] ]  # 43 #rgb‚Äîcenterpoints
#   - [ 21, 1, SilenceList, [ 256, 2 ] ]  # 44 #rgb-uav_exist
#   - [ 21, 1, SilenceList, [ 256, 3 ] ]  # 45 #rgb-ir-offsets



  # - [ [2,4,6,8,10, 12,14,16,18,20], 1, RGBAdjuster, [496, 3, 1, True]]  #  21 Affine
  # - [ [2,4,6,8,10, 12,14,16,18,20], 1, RGBAdjuster, [496, 3, 1, True, True, False, False, False]]  #  21 Affine+centerpoint
  # - [ [2,4,6,8,10, 12,14,16,18,20], 1, RGBAdjuster, [496, 3, 1, True, False, True, False, False]]  #  21 Affine+uav_exist
  # - [ [2,4,6,8,10, 12,14,16,18,20], 1, RGBAdjuster, [496, 3, 1, True, False, False, True, False]]  #  21 Affine+weight_map
  # - [ [2,4,6,8,10, 12,14,16,18,20], 1, RGBAdjuster, [496, 3, 1, True, False, False, False, True]]  #  21 Affine+local_point
  - [ [2,4,6,8,10, 12,14,16,18,20], 1, RGBAdjuster, [496, 3, 1, False, False, True]]  #  21 uav_exist

  - [ -1, 1, SilenceList, [ 16, 0 ] ]  # 22 #rgb
  - [ 21, 1, SilenceList, [ 16, 1 ] ]  # 23 #rgb‚Äîcenterpoints
  - [ 21, 1, SilenceList, [ 16, 2 ] ]  # 24 #rgb-uav_exist
  - [ 21, 1, SilenceList, [ 16, 3 ] ]  # 25 #rgb-ir-offsets

  - [ 22, 1, SilenceList, [ 16, 0 ] ]  # 26 #Á¨¨‰∏ÄÂ±Ç.Â∑≤ÁªèÂØπÈΩê
  - [ 22, 1, SilenceList, [ 32, 1 ] ]  # 27 #Á¨¨‰∫åÂ±Ç
  - [ 22, 1, SilenceList, [ 64, 2 ] ]  # 28 #Á¨¨‰∏âÂ±Ç
  - [ 22, 1, SilenceList, [ 128, 3 ] ]  # 29 #Á¨¨ÂõõÂ±Ç
  - [ 22, 1, SilenceList, [ 256, 4 ] ]  # 30 #Á¨¨‰∫îÂ±Ç

  - [[28, 16], 1, Concat, [1]]  # cat backbone B3   31
  - [[29, 18], 1, Concat, [1]]  # cat backbone B4   32
  - [[30, 20], 1, Concat, [1]]  # cat backbone P5   33
  - [-1, 1, SPPF, [1024, 5]]  # 34-B5/32

head:
  # Semantic Collecting
  - [26, 1, nn.AvgPool2d, [8, 8, 0]] # 35
  - [27, 1, nn.AvgPool2d, [4, 4, 0]] # 36
  - [28, 1, nn.AvgPool2d, [2, 2, 0]] # 37

  # infrared
  - [12, 1, nn.AvgPool2d, [8, 8, 0]] # 38
  - [14, 1, nn.AvgPool2d, [4, 4, 0]] # 39
  - [16, 1, nn.AvgPool2d, [2, 2, 0]] # 40

  - [34, 1, nn.Upsample, [None, 2, 'nearest']] # 41
  - [[35,36,37,38,39,40,41], 1, Concat, [1]]  # cat 42

  # Hypergraph Computation
  - [-1, 1, Conv, [512, 1, 1]] # 43
  - [-1, 1, HyperComputeModule, [512]] # 44
  - [-1, 3, MANet, [512, True, 2, 3]] # 45
#
  # Semantic Collecting
  - [-1, 1, nn.AvgPool2d, [2, 2, 0]] # 46
  - [[-1,34], 1, Concat, [1]]  # cat 47
  - [-1, 1, Conv, [1024, 1, 1]] # 48 P5
#
  - [[45, 32], 1, Concat, [1]]  # cat 49
  - [-1, 3, MANet, [512, False, 2, 3]]  # 50 P4

  - [45, 1, nn.Upsample, [None, 2, 'nearest']] # 51
  - [[-1, 31], 1, Concat, [1]]  # cat 52
  - [-1, 3, MANet, [256, False, 2, 3]]  # 53 P3/N3
#
  - [-1, 1, Conv, [256, 3, 2]] # 54
  - [[-1, 50], 1, Concat, [1]]  # 55 cat
  - [-1, 3, MANet, [512, False, 2, 3]]  # 56 N4
#
  - [-1, 1, Conv, [512, 3, 2]] # 57
  - [[-1, 48], 1, Concat, [1]]  # 58 cat
  - [-1, 3, C2f, [1024, False]]  # 59 N5
  - [[53, 56, 59, 23, 24, 25], 1, Detect, [nc]]  # Detect(N3, N4, N5)

#Âü∫‰∫écat
# head:
#   # Semantic Collecting
#   - [22, 1, nn.AvgPool2d, [8, 8, 0]] # 50
#   - [27, 1, nn.AvgPool2d, [4, 4, 0]] # 51
#   - [32, 1, nn.AvgPool2d, [2, 2, 0]] # 52

#   # infrared
#   - [12, 1, nn.AvgPool2d, [8, 8, 0]] # 53
#   - [14, 1, nn.AvgPool2d, [4, 4, 0]] # 54
#   - [16, 1, nn.AvgPool2d, [2, 2, 0]] # 55

#   - [49, 1, nn.Upsample, [None, 2, 'nearest']] # 56
#   - [[50,51,52,53,54,55,56], 1, Concat, [1]]  # cat 57

#   # Hypergraph Computation
#   - [-1, 1, Conv, [512, 1, 1]] # 58
#   - [-1, 1, HyperComputeModule, [512]] # 59
#   - [-1, 3, MANet, [512, True, 2, 3]] # 60
# #
#   # Semantic Collecting
#   - [-1, 1, nn.AvgPool2d, [2, 2, 0]] # 61
#   - [[-1,49], 1, Concat, [1]]  # cat 62
#   - [-1, 1, Conv, [1024, 1, 1]] # 63 P5
# #
#   - [[60, 47], 1, Concat, [1]]  # cat 64
#   - [-1, 3, MANet, [512, False, 2, 3]]  # 65 P4

#   - [60, 1, nn.Upsample, [None, 2, 'nearest']] # 66
#   - [[-1, 46], 1, Concat, [1]]  # cat 67
#   - [-1, 3, MANet, [256, False, 2, 3]]  # 68 P3/N3
# #
#   - [-1, 1, Conv, [256, 3, 2]] # 69
#   - [[-1, 65], 1, Concat, [1]]  # 70 cat
#   - [-1, 3, MANet, [512, False, 2, 3]]  # 71 N4
# #
#   - [-1, 1, Conv, [512, 3, 2]] # 72
#   - [[-1, 63], 1, Concat, [1]]  # 73 cat
#   - [-1, 3, C2f, [1024, False]]  # 74 N5
#   - [[68, 71, 74, 23, 28, 33, 38, 43, 24, 29, 34, 39, 44, 25, 30, 35, 40, 45], 1, Detect, [nc]]  # Detect(N3, N4, N5)





# # Hyper-YOLO head
# head:
#   # Semantic Collecting
#   - [22, 1, nn.AvgPool2d, [8, 8, 0]] # 50 rgb
#   - [27, 1, nn.AvgPool2d, [4, 4, 0]] # 51
#   - [32, 1, nn.AvgPool2d, [2, 2, 0]] # 52
#   - [42, 1, nn.Upsample, [None, 2, 'nearest']] # 53
#   - [[50, 51, 52, 37, 53], 1, Concat, [1]]  # cat 54
#   - [-1, 1, Conv, [512, 1, 1]] # 55
#   # infrared
#   - [12, 1, nn.AvgPool2d, [8, 8, 0]] # 56 ir
#   - [14, 1, nn.AvgPool2d, [4, 4, 0]] # 57
#   - [16, 1, nn.AvgPool2d, [2, 2, 0]] # 58
#   - [20, 1, nn.Upsample, [None, 2, 'nearest']] # 59
#   - [[56,57,58,18,59], 1, Concat, [1]]  # cat 60
#   - [-1, 1, Conv, [512, 1, 1]] # 61

#   # Hypergraph Computation
#   - [[55,61], 1, HyperComputeModule, [512]] # 62 #
#   - [-1, 3, MANet, [512, True, 2, 3]] # 63
# #
#   # Semantic Collecting
#   - [-1, 1, nn.AvgPool2d, [2, 2, 0]] # 64
#   - [[-1,49], 1, Concat, [1]]  # cat 65
#   - [-1, 1, Conv, [1024, 1, 1]] # 66 
# #
#   - [[63, 47], 1, Concat, [1]]  # cat 67 
#   - [-1, 3, MANet, [512, False, 2, 3]]  # 68 P4

#   - [63, 1, nn.Upsample, [None, 2, 'nearest']] # 69
#   - [[-1, 46], 1, Concat, [1]]  # cat 70
#   - [-1, 3, MANet, [256, False, 2, 3]]  # 71 P3/N3
# #
#   - [-1, 1, Conv, [256, 3, 2]] # 72
#   - [[-1, 68], 1, Concat, [1]]  # 73 cat
#   - [-1, 3, MANet, [512, False, 2, 3]]  # 74 N4
# #
#   - [-1, 1, Conv, [512, 3, 2]] # 75
#   - [[-1, 66], 1, Concat, [1]]  # 76 cat
#   - [-1, 3, C2f, [1024, False]]  # 77   N5
#   - [[71, 74, 77, 23, 28, 33, 38, 43, 24, 29, 34, 39, 44, 25, 30, 35, 40, 45], 1, Detect, [nc]]  # Detect(N3, N4, N5) rgb‚Äîcenterpoints,rgb-uav_exist,rgb-ir-offsets



# #ÂÆåÊï¥
#   - [ 6, 1, CenterPredictor, [64]]  #  21  ##ËûçÂêàÂ±Ç1
#   - [ [6, 16], 1, RGBAdjuster, [64]]  #  22
#   - [ -1, 1, SilenceList, [ 64, 0 ] ]  # 23
#   - [ 22, 1, SilenceList, [ 64, 1 ] ]  # 24
#   - [ 22, 1, SilenceList, [ 64, 2 ] ]  # 25
#   - [ [23, 24], 1, Fusion_Module, [64]]  # 26

#   - [ 8, 1, CenterPredictor, [128]]  #  27  ##ËûçÂêàÂ±Ç2
#   - [ [8, 18], 1, RGBAdjuster, [128]]  #  28
#   - [ -1, 1, SilenceList, [ 128, 0 ] ]  # 29
#   - [ 28, 1, SilenceList, [ 128, 1 ] ]  # 30
#   - [ 28, 1, SilenceList, [ 128, 2 ] ]  # 31
#   - [ [29, 30], 1, Fusion_Module, [128]]  #  32

#   - [ 10, 1, CenterPredictor, [256]]  #  33  ##ËûçÂêàÂ±Ç3
#   - [ [10, 20], 1, RGBAdjuster, [256]]  #  34
#   - [ -1, 1, SilenceList, [ 256, 0 ] ]  # 35
#   - [ 34, 1, SilenceList, [ 256, 1 ] ]  # 36
#   - [ 34, 1, SilenceList, [ 256, 2 ] ]  # 37
#   - [ [35, 36], 1, Fusion_Module, [256]]  #  38
#   - [-1, 1, SPPF, [1024, 5]]  # 39-B5/39

# # Hyper-YOLO head
# head:
#   # Semantic Collecting
#   - [2, 1, nn.AvgPool2d, [8, 8, 0]] # 40
#   - [4, 1, nn.AvgPool2d, [4, 4, 0]] # 41
#   - [6, 1, nn.AvgPool2d, [2, 2, 0]] # 42

#   # infrared
#   - [12, 1, nn.AvgPool2d, [8, 8, 0]] # 43
#   - [14, 1, nn.AvgPool2d, [4, 4, 0]] # 44
#   - [16, 1, nn.AvgPool2d, [2, 2, 0]] # 45

#   - [39, 1, nn.Upsample, [None, 2, 'nearest']] # 46
#   - [[40,41,42,43,44,45,46], 1, Concat, [1]]  # cat 47

#   # Hypergraph Computation
#   - [-1, 1, Conv, [512, 1, 1]] # 48
#   - [-1, 1, HyperComputeModule, [512]] # 49
#   - [-1, 3, MANet, [512, True, 2, 3]] # 50
# #
#   # Semantic Collecting
#   - [-1, 1, nn.AvgPool2d, [2, 2, 0]] # 51
#   - [[-1,39], 1, Concat, [1]]  # cat 52
#   - [-1, 1, Conv, [1024, 1, 1]] # 38 53
# #
#   - [[50, 32], 1, Concat, [1]]  # cat 54
#   - [-1, 3, MANet, [512, False, 2, 3]]  # 40 55

#   - [50, 1, nn.Upsample, [None, 2, 'nearest']] # 56
#   - [[-1, 26], 1, Concat, [1]]  # cat 57
#   - [-1, 3, MANet, [256, False, 2, 3]]  # 58 P3/N3
# #
#   - [-1, 1, Conv, [256, 3, 2]] # 59
#   - [[-1, 55], 1, Concat, [1]]  # 60 cat
#   - [-1, 3, MANet, [512, False, 2, 3]]  # 61 N4
# #
#   - [-1, 1, Conv, [512, 3, 2]] # 62
#   - [[-1, 53], 1, Concat, [1]]  # 63 cat
#   - [-1, 3, C2f, [1024, False]]  # 64 N5
#   - [[58, 61, 64], 1, Detect, [nc]]  # Detect(N3, N4, N5)






